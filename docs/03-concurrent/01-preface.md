# 前言

+ 为什需要并行
+ 几个重要的概念
 * 同步（synchronous）和异步（asynchronous）
 * 并发（concurrency）和并行（Parallelism）
 * 临界区
 * 阻塞（Blocking）和非阻塞（Non-Blocking）
 * 死锁（Deadlock）、饥饿（Starvation）和活锁（Livelock）
 * 并行的级别
+ 有关并行的两个重要定律
 * Amdahl定律（阿姆达尔定律）
 * Gustafson定律（古斯塔夫森）
  

###1、为什么需要并行？

+ 业务模型需要
+ 性能

举例jvm线程有
* 主线程
* 即时编译线程
* gc线程

Linux Torvalds：忘掉那该死的并行吧！

并行只有在图像处理和服务端编程2个领域可以使用，并且它在这个2个领域有这大量广泛使用。
其他任何地方，并行计算毫无建树！

cpu密集计算

摩尔定律的失效

2004年以后，10年过去了，我们还停留在4GHZ（单核CPU主频）

并发现象或多或少是由于硬件设计者已经无计可施导致的。

并不是为了提高系统性能，而是确实在业务上需要多个执行单元。
比如http服务器，为每个socket连接新建一个处理线程。
让不同线程承担不同的业务工作。
简化任务调度。

###2、几个重要的概念

####2.1 同步（synchronous）和异步（asynchronous）

针对方法调用来说：
同步：调用的方法执行完成后，再继续执行。
异步：调用的方法调用后，马上执行其他方法。而在方法内部新启动一个线程执行，至于什么时候执行完不可而知。

####2.2 并发（concurrency）和并行（Parallelism）

并行：两个线程同时进行。或者两个进程，两个cpu。
并发：一会做这个，一会做那个，会有一个调度。比如单个cpu。

####2.3 临界区

临界区表示一种公共资源或者共享数据，可以被多线程使用。但每次只有一个线程使用，一旦临界区资源被占用，
其他线程想要使用这个资源，必须阻塞等待队列。

####2.4 阻塞（Blocking）和非阻塞（Non-Blocking）

阻塞：一个线程占用临界区，其他需要这个资源的线程就必须在这临界区等待，等待会导致线程挂起。这就是阻塞。
     如果一个线程一直不愿意释放资源，那么所有阻塞在这个临界区的线程都不能工作。
非阻塞：允许多个线程同时进入临界区

####2.5 死锁（Deadlock）、饥饿（Starvation）和活锁（Livelock）

死锁：比如四辆围一圈的车，依次想开往下一个车的位置，都开不动。所有线程卡死，不会占用cpu。

活锁：比如两个人左右互相让路，结果还是相互挡住了对方的路。线程不停在运行互相阻塞，占用cpu，比死锁更难排查。

饥饿：比如优先级低等，指某一个或者多个线程因为种种原因无法获得需要的资源，导致一直无法执行。

####2.6 并行的级别

+ 阻塞：一个线程进入临界区后，其他线程就必须等待。
+ 无障碍：Obstruction-free
   * 无障碍是一种最弱的非阻塞调度，
   * 自由出入临界区，
   * 无竞争时，有限步内完成操作，
   * 有竞争时，回滚数据。
   * eg.都可以进入临界区，读或写，如果与其他有冲突，回滚数据，比如被其他线程修改，重新读取数据。    

+ 无锁：（Lock-Free）
   * 是无障碍的
   * 保证有一个线程可以胜出。
   * eg.比如：10个线程都可以修改一个资源，但同一时间只有一个可以修改。依次类推。
   * eg.例如： while(!atomicVar.compareAndSet(localVar, localVar+1)){ //TODO} 
+ 无等待：（Wait-Free）
   * 无锁的
   * 要求所有的线程都必须在有限步内完成
   * 无饥饿的
   
###3.有关并行的两个重要定律

[并行计算加速比](http://blog.csdn.net/u010945683/article/details/51534867)

####3.1 Amdahl定律（阿姆达尔定律）
>把普通程序编程并行化后到底有多快

+ 定义了串行系统并行化后的加速比的计算公式和理论上线
+ 加速比定义：加速比=优化钱系统耗时/优化后系统耗时

比如要上传一些文件
步骤一（100个图片）， 步骤二（100个视频） 

步骤一（2个线程分别上传50个图片）， 步骤二（两个线程分别上传50个视频）。

200/100 = 2


####3.2 Gustafson定律（古斯塔夫森）

+ 说明处理器个数，串行比例和加速比之间的关系
+ 只要有足够的并行化，那么加速比和cpu个数成正比

> 优化程序在并行化的同时也要，添加cpu个数。


###4、作业讨论

>1.如果有5个步骤的程序，每个步骤消耗100个时间单位。假设步骤2和步骤5可以完全并行，并且你有无穷多个处理器。那么根据Amdahl加速比是多少?


>2.举出 日常生活中死锁的例子（ppt中的小车死锁已经哲学家就餐不能作为本题答案）


>3.举出 日常生活中 阻塞并行 的例子
汽车进小区刷卡，食堂买饭刷卡，排队买票